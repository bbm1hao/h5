/*  
 * HTML5音乐播放器 
 * sherlock 
 * 2014 04/01 22:19 
 * 2.0版本 
 * 功能 : 进度＋－ 播放暂停 显示时间 
 */
var LockAudio=function(t){var i=$(t);this.media=i.find(".lockAudio-default")[0],this.process=i.find(".lockAudio-progress"),this.processComplete=i.find(".lockAudio-progress-complete"),this.pauseTime=i.find("#pauseTime"),this.timer="",this.btn=i.find(".lockAudio-btn"),this.info=i.find(".lockAudio-info"),this.timeInfo=i.find(".lockAudio-timeInfo"),this.debug=!1;var o=this,e=function(){o.btn.bind("click",function(){var t=$(this),i=t.attr("status");o.toggleStatus(i)}),o.process.bind("click",function(t){t.stopPropagation(),""==o.timer&&o.toggleStatus(LockAudio.STATUS.Play);var i=$(this),e=i.offset(),s=e.left,n=i.width(),a=t.clientX-s;o.durationProcessRange(a/n),o.processComplete.css("width",a)}),o.processComplete.bind("click",function(t){t.stopPropagation();var i=o.process.offset(),e=i.left,s=i.width,n=t.clientX-e;o.durationProcessRange(n/s),o.processComplete.css("width",n)})};this.media.addEventListener("loadstart",function(){}),this.media.addEventListener("progress",function(){}),this.media.addEventListener("suspend",function(){}),this.media.addEventListener("abort",function(){o.toggleStatus(LockAudio.STATUS.Error,"客户端终止下载")}),this.media.addEventListener("error",function(){o.toggleStatus(LockAudio.STATUS.Error,"音频加载失败或不存在")}),this.media.addEventListener("play",function(){o.info.html("播放中")}),this.media.addEventListener("canplaythrough",function(){o.info.html("歌曲载入完成")}),this.media.addEventListener("canplay",function(){o.info.html("缓冲可播")}),this.media.addEventListener("pause",function(){o.info.html("暂停")}),this.media.addEventListener("ended",function(){o.toggleStatus(LockAudio.STATUS.Stop,"歌曲结束")}),e()};LockAudio.STATUS={Play:"1",Pause:"2",Running:"3",Stop:"0",Error:"-1"},LockAudio.prototype.durationProcessRange=function(t){var i=t*this.media.duration;this.media.pause(),this.media.currentTime=i,this.toggleStatus(LockAudio.STATUS.Running)},LockAudio.prototype.play=function(){this.media.play(),this.timeSpan()},LockAudio.prototype.pause=function(){this.pauseTime.val(this.media.currentTime),this.media.pause()},LockAudio.prototype.keepOn=function(){this.media.startTime=this.pauseTime.val(),this.media.play()},LockAudio.prototype.timeSpan=function(){var t=this.media,i=this;this.timer=setInterval(function(){var o=100*(t.currentTime/t.duration);i.processComplete.css("width",o+"%");var e=LockAudio.timeDispose(t.currentTime),s=LockAudio.timeDispose(i.timeAll());i.timeInfo.html(e+" | "+s)},1e3)},LockAudio.timeDispose=function(t){var i=parseInt(t/60),o=parseInt(t%60);return i=i>=10?i:"0"+i,o=o>=10?o:"0"+o,i+":"+o},LockAudio.prototype.timeAll=function(){return this.media.duration},LockAudio.prototype.toggleStatus=function(t,i){var o=$(this.btn);t==LockAudio.STATUS.Play&&(this.play(),t=LockAudio.STATUS.Running),t==LockAudio.STATUS.Stop?(o.removeClass("lockAudio-btn-pause").addClass("lockAudio-btn-play"),clearInterval(this.timer),this.processComplete.width(0),this.info.html(i),this.timeInfo.html("00:00 | 00:00"),this.timer="",t=LockAudio.STATUS.Play):t==LockAudio.STATUS.Running?(o.removeClass("lockAudio-btn-play").addClass("lockAudio-btn-pause"),this.keepOn(),t=LockAudio.STATUS.Pause):t==LockAudio.STATUS.Pause?(o.removeClass("lockAudio-btn-pause").addClass("lockAudio-btn-play"),this.pause(),t=LockAudio.STATUS.Running):t==LockAudio.STATUS.Error&&(o.removeClass("lockAudio-btn-play").addClass("lockAudio-btn-error"),this.info.html(i),t=LockAudio.STATUS.Error),o.attr("status",t)};